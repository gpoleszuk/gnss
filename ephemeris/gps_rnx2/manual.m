clc; more off; format short;
c = 299792458.0;
OMGE=7.2921151467E-5  % For WGS84
f0 = 10230000.0;
f1 = 154.0 * f0;
f2 = 120.0 * f0;
l1 = c / f1;
l2 = c / f2;


function d=d3d(p1, p2)
  d=sqrt( (p2(1) - p1(1))^2 + (p2(2) - p1(2))^2 + (p2(3) - p1(3))^2 );
endfunction

% Talbot 1991
% DD phi_{1,2}^{i,j} = phi_1^i - phi_1^j - phi_2^i + phi_2^j 
% DD rho_{1,2}^{i,j} = rho_1^i - rho_1^j - rho_2^i + rho_2^j 
% N  phi_{1,2}^{i,j} =   N_1^i -   N_1^j -   N_2^i +   N_2^j 
#            rho_1_i = sqrt( (X^i - X_1)^2 + (Y^i - Y_1)^2 + (Z^i - Z_1)^2 )




b = [  3965001.0789 -4392463.1685 -2374512.5743 ];
r = [  3964449.8488 -4392493.0994 -2375390.2399 ];
r = [  3964449.805106 -4392492.904627 -2375390.333900 ];
%r   = [  3964449.850 -4392493.106 -2375390.246 ];
r = [ 3964446.217350 -4392487.876677 -2375388.066596 ];
r = [ 3964449.848800 -4392493.099400 -2375390.239900 ];


% ( 1) 2017/03/29 13:30:00.000 G18 rcv1 113407358.314  88369374.712  21580703.380  21580702.780 0 0 1 20 50.5 43.0
% ( 2) 2017/03/29 13:30:00.000 G20 rcv1 110494945.277  86099953.500  21026489.640  21026489.020 0 0 1 20 49.8 45.0
% ( 3) 2017/03/29 13:30:00.000 G21 rcv1 109987370.041  85704439.947  20929900.560  20929899.740 0 0 1 20 50.0 44.8
% ( 4) 2017/03/29 13:30:00.000 G25 rcv1 111047886.179  86530826.271  21131711.760  21131714.340 0 0 1 20 50.2 45.8
% ( 5) 2017/03/29 13:30:00.000 G26 rcv1 121228063.005  94463445.253  23068932.220  23068935.940 0 0 1 20 46.2 40.2
% ( 6) 2017/03/29 13:30:00.000 G29 rcv1 111015025.462  86505214.578  21125457.620  21125457.740 0 0 1 20 50.8 45.2
% ( 7) 2017/03/29 13:30:00.000 G18 rcv2 113404476.739  88367107.265  21580149.100  21580149.480 0 0 1 20 48.2 41.2
% ( 8) 2017/03/29 13:30:00.000 G20 rcv2 110495458.700  86100356.046  21026587.060  21026586.820 0 0 1 20 46.8 42.0
% ( 9) 2017/03/29 13:30:00.000 G21 rcv2 109990153.129  85706599.730  20930429.220  20930429.020 0 0 1 20 50.2 44.8
% (10) 2017/03/29 13:30:00.000 G25 rcv2 111044740.993  86528375.123  21131113.460  21131116.860 0 0 1 20 49.5 43.8
% (11) 2017/03/29 13:30:00.000 G26 rcv2 121232626.331  94467019.458  23069799.480  23069803.300 0 0 1 20 45.5 38.8
% (12) 2017/03/29 13:30:00.000 G29 rcv2 111016526.897  86506384.273  21125742.900  21125743.240 0 0 1 20 49.0 35.5


% Rover
G18re0001 = [ 113407358.314  88369374.712  21580703.380  21580702.780 0 0 1 20 50.5 43.0 ];
G20re0001 = [ 110494945.277  86099953.500  21026489.640  21026489.020 0 0 1 20 49.8 45.0 ];
G21re0001 = [ 109987370.041  85704439.947  20929900.560  20929899.740 0 0 1 20 50.0 44.8 ];
G25re0001 = [ 111047886.179  86530826.271  21131711.760  21131714.340 0 0 1 20 50.2 45.8 ];
G26re0001 = [ 121228063.005  94463445.253  23068932.220  23068935.940 0 0 1 20 46.2 40.2 ];
G29re0001 = [ 111015025.462  86505214.578  21125457.620  21125457.740 0 0 1 20 50.8 45.2 ];

% Base
G18be0001 = [ 113404476.739  88367107.265  21580149.100  21580149.480 0 0 1 20 48.2 41.2 ];
G20be0001 = [ 110495458.700  86100356.046  21026587.060  21026586.820 0 0 1 20 46.8 42.0 ];
G21be0001 = [ 109990153.129  85706599.730  20930429.220  20930429.020 0 0 1 20 50.2 44.8 ];
G25be0001 = [ 111044740.993  86528375.123  21131113.460  21131116.860 0 0 1 20 49.5 43.8 ];
G26be0001 = [ 121232626.331  94467019.458  23069799.480  23069803.300 0 0 1 20 45.5 38.8 ];
G29be0001 = [ 111016526.897  86506384.273  21125742.900  21125743.240 0 0 1 20 49.0 35.5 ];

format long g

 21580146.147724;  21580143.115743
 21026583.822593;  21026581.272893
 20930426.286606;  20930423.615211
 21131106.818225;  21131104.214818
 23069791.240199;  23069786.866691
 21125741.054630;  21125738.354443
 
printf("\n");
 
% Base
%4 rr_=3965001.078900 -4392463.168500 -2374512.574300
%4 pos=-21.997928255018 -47.927975415940 833.965543
%4 sat=18  13572817.967240 -22048174.078842   5965851.668300  0.00060749821403  342.6659    43.5606
%4 sat=20  20604422.732656  -7705492.328319 -15030213.306327  0.00046608327791  123.2275    55.0947
%4 sat=21   4112932.050924 -21351743.932502 -14374656.398401 -0.00051501853079  240.4742    51.4990
%4 sat=25  19568952.813312 -17561977.707616   2630103.303249 -0.00036068355144   12.7219    53.4289
%4 sat=26  -3190194.305582 -17088242.656867 -20058205.249503 -0.00051658191155  223.3030    28.4500
%4 sat=29  18129968.401209  -7033115.700957 -18075605.209719  0.00061674525353  139.5804    50.7343
%4 y=
%         8.2888881974         2.8959167643         3.9763998642         4.8440853105        10.5192365675         1.6417913912
%         2.9984471537         3.2923537238         2.9858278885         6.6955841937         8.2717188215         1.8972427985

g18b = [ 13572817.967240 -22048174.078842   5965851.668300  0.00060749821403  342.6659    43.5606 ];
g20b = [ 20604422.732656  -7705492.328319 -15030213.306327  0.00046608327791  123.2275    55.0947 ];
g21b = [  4112932.050924 -21351743.932502 -14374656.398401 -0.00051501853079  240.4742    51.4990 ];
g25b = [ 19568952.813312 -17561977.707616   2630103.303249 -0.00036068355144   12.7219    53.4289 ];
g26b = [ -3190194.305582 -17088242.656867 -20058205.249503 -0.00051658191155  223.3030    28.4500 ];
g29b = [ 18129968.401209  -7033115.700957 -18075605.209719  0.00061674525353  139.5804    50.7343 ];

% Rover
%4 rr_=3964449.848800 -4392493.099400 -2375390.239900
%4 pos=-22.006450477893 -47.932131811034 840.931101
%4 sat=18  13572817.965853 -22048174.078356   5965851.673819  0.00060749821403  342.6759    43.5522
%4 sat=20  20604422.732341  -7705492.327783 -15030213.307041  0.00046608327791  123.2110    55.0965
%4 sat=21   4112932.052489 -21351743.929352 -14374656.402441 -0.00051501853079  240.4854    51.5084
%4 sat=25  19568952.813451 -17561977.708464   2630103.296855 -0.00036068355144   12.7269    53.4175
%4 sat=26  -3190194.300272 -17088242.661998 -20058205.245952 -0.00051658191155  223.3071    28.4600
%4 sat=29  18129968.403254  -7033115.700192 -18075605.207961  0.00061674525353  139.5676    50.7392
%4 y=
%         1.1767540067         1.2918374864         1.8026505813         4.0174087986         8.1586134477        -0.1400758856
%         1.8208227656         1.9694228162         1.7561158493         5.6599121085         7.0231604135         0.5489561438



% pos=-22.006450511 -47.932131845 840.938;
g18r = [ 13572817.965853 -22048174.078356   5965851.673819  0.00060749821403  342.6758    43.5522 ];
g20r = [ 20604422.732341  -7705492.327783 -15030213.307041  0.00046608327791  123.2110    55.0965 ];
g21r = [  4112932.052489 -21351743.929352 -14374656.402441 -0.00051501853079  240.4854    51.5084 ];
g25r = [ 19568952.813451 -17561977.708464   2630103.296855 -0.00036068355144   12.7269    53.4175 ];
g26r = [ -3190194.300272 -17088242.661998 -20058205.245952 -0.00051658191155  223.3071    28.4600 ];
g29r = [ 18129968.403254  -7033115.700192 -18075605.207961  0.00061674525353  139.5676    50.7392 ];

%g18r-g18b
%g20r-g20b
%g21r-g21b
%g25r-g25b
%g26r-g26b
%g29r-g29b

format long g

G18be0001(1)*l1-(norm(g18b(1:3)-b(1:3)) + OMGE*(g18b(1)*b(2)-g18b(2)*b(1))/c - g18b(4)*c)
%(sqrt( (g18b(1)-b(1))^2 + (g18b(2)-b(2))^2 + (g18b(3)-b(3))^2 ) )
 

printf("\n");sag_01

G20be0001(1)*l1
(sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - g20b(4)*c)

G18re0001(1)*l1
(sqrt( (g18r(1)-r(1))^2 + (g18r(2)-r(2))^2 + (g18r(3)-r(3))^2 ) - g18r(4)*c)

G20re0001(1)*l1
(sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ) - g20r(4)*c)

pause


printf("\n");

(r02G18e0001(1) - r02G20e0001(1) - r01G18e0001(1) + r01G20e0001(1))*l1 - (sqrt( (g18b(1)-b(1))^2 + (g18b(2)-b(2))^2 + (g18b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                          sqrt( (g18r(1)-r(1))^2 + (g18r(2)-r(2))^2 + (g18r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
(r02G21e0001(1) - r02G20e0001(1) - r01G21e0001(1) + r01G20e0001(1))*l1 - (sqrt( (g21b(1)-b(1))^2 + (g21b(2)-b(2))^2 + (g21b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                          sqrt( (g21r(1)-r(1))^2 + (g21r(2)-r(2))^2 + (g21r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
(r02G25e0001(1) - r02G20e0001(1) - r01G25e0001(1) + r01G20e0001(1))*l1 - (sqrt( (g25b(1)-b(1))^2 + (g25r(2)-b(2))^2 + (g25b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                          sqrt( (g25r(1)-r(1))^2 + (g25r(2)-r(2))^2 + (g25r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
(r02G26e0001(1) - r02G20e0001(1) - r01G26e0001(1) + r01G20e0001(1))*l1 - (sqrt( (g26b(1)-b(1))^2 + (g26b(2)-b(2))^2 + (g26b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                          sqrt( (g26r(1)-r(1))^2 + (g26r(2)-r(2))^2 + (g26r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
(r02G29e0001(1) - r02G20e0001(1) - r01G29e0001(1) + r01G20e0001(1))*l1 - (sqrt( (g29b(1)-b(1))^2 + (g29b(2)-b(2))^2 + (g29b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                          sqrt( (g29r(1)-r(1))^2 + (g29r(2)-r(2))^2 + (g29r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))

printf("\n");


r02G18e0001(3) - r02G20e0001(3) - r01G18e0001(3) + r01G20e0001(3) - (sqrt( (g18b(1)-b(1))^2 + (g18b(2)-b(2))^2 + (g18b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                     sqrt( (g18r(1)-r(1))^2 + (g18r(2)-r(2))^2 + (g18r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
r02G21e0001(3) - r02G20e0001(3) - r01G21e0001(3) + r01G20e0001(3) - (sqrt( (g21b(1)-b(1))^2 + (g21b(2)-b(2))^2 + (g21b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                     sqrt( (g21r(1)-r(1))^2 + (g21r(2)-r(2))^2 + (g21r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
r02G25e0001(3) - r02G20e0001(3) - r01G25e0001(3) + r01G20e0001(3) - (sqrt( (g25b(1)-b(1))^2 + (g25b(2)-b(2))^2 + (g25b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                     sqrt( (g25r(1)-r(1))^2 + (g25r(2)-r(2))^2 + (g25r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
r02G26e0001(3) - r02G20e0001(3) - r01G26e0001(3) + r01G20e0001(3) - (sqrt( (g26b(1)-b(1))^2 + (g26b(2)-b(2))^2 + (g26b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                     sqrt( (g26r(1)-r(1))^2 + (g26r(2)-r(2))^2 + (g26r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))
r02G29e0001(3) - r02G20e0001(3) - r01G29e0001(3) + r01G20e0001(3) - (sqrt( (g29b(1)-b(1))^2 + (g29b(2)-b(2))^2 + (g29b(3)-b(3))^2 ) - sqrt( (g20b(1)-b(1))^2 + (g20b(2)-b(2))^2 + (g20b(3)-b(3))^2 ) - ...
                                                                     sqrt( (g29r(1)-r(1))^2 + (g29r(2)-r(2))^2 + (g29r(3)-r(3))^2 ) + sqrt( (g20r(1)-r(1))^2 + (g20r(2)-r(2))^2 + (g20r(3)-r(3))^2 ))

pause;
%-0.046163998
%-0.054947854
%-0.052440859
%-0.053800957
%-0.031928507
%-0.051876294



%4 y=
%        -3.7881293548        -3.6307164073        -3.6946155459        -1.3824334940         4.7476434643        -4.7563969344
%        -3.1440605959        -2.9531310774        -3.7411502779         0.2600698160         3.6121904301        -4.0673649050


d_b_18b =  d3d(b,g18b);
d_b_20b =  d3d(b,g20b);
d_b_21b =  d3d(b,g21b);
d_b_25b =  d3d(b,g25b);
d_b_26b =  d3d(b,g26b);
d_b_29b =  d3d(b,g29b);

d_r_18r =  d3d(r,g18r);
d_r_20r =  d3d(r,g20r);
d_r_21r =  d3d(r,g21r);
d_r_25r =  d3d(r,g25r);
d_r_26r =  d3d(r,g26r);
d_r_29r =  d3d(r,g29r);

%r01G18e0001_0 = [ d_r_18/l1 - g18(4)*c ]

r01G18e0001_0 = [ 113407358.314  88369374.712  21580703.380  21580702.780 0 0 1 20 50.5 43.0 ];
r01G20e0001_0 = [ 110494945.277  86099953.500  21026489.640  21026489.020 0 0 1 20 49.8 45.0 ];
r01G21e0001_0 = [ 109987370.041  85704439.947  20929900.560  20929899.740 0 0 1 20 50.0 44.8 ];
r01G25e0001_0 = [ 111047886.179  86530826.271  21131711.760  21131714.340 0 0 1 20 50.2 45.8 ];
r01G26e0001_0 = [ 121228063.005  94463445.253  23068932.220  23068935.940 0 0 1 20 46.2 40.2 ];
r01G29e0001_0 = [ 111015025.462  86505214.578  21125457.620  21125457.740 0 0 1 20 50.8 45.2 ];
r02G18e0001_0 = [ 113404476.739  88367107.265  21580149.100  21580149.480 0 0 1 20 48.2 41.2 ];
r02G20e0001_0 = [ 110495458.700  86100356.046  21026587.060  21026586.820 0 0 1 20 46.8 42.0 ];
r02G21e0001_0 = [ 109990153.129  85706599.730  20930429.220  20930429.020 0 0 1 20 50.2 44.8 ];
r02G25e0001_0 = [ 111044740.993  86528375.123  21131113.460  21131116.860 0 0 1 20 49.5 43.8 ];
r02G26e0001_0 = [ 121232626.331  94467019.458  23069799.480  23069803.300 0 0 1 20 45.5 38.8 ];
r02G29e0001_0 = [ 111016526.897  86506384.273  21125742.900  21125743.240 0 0 1 20 49.0 35.5 ];

%if(false)

  Kll = [
   0.000100 0.000050 0.000050 0.000050 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000050 0.000100 0.000050 0.000050 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000050 0.000050 0.000100 0.000050 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000050 0.000050 0.000050 0.000100 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000050 0.000050 0.000050 0.000050 0.000100 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000100 0.000050 0.000050 0.000050 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000050 0.000100 0.000050 0.000050 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000050 0.000050 0.000100 0.000050 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000050 0.000050 0.000050 0.000100 0.000050 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000050 0.000050 0.000050 0.000050 0.000100 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.500000 0.500000 0.500000 0.500000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 1.000000 0.500000 0.500000 0.500000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 0.500000 1.000000 0.500000 0.500000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 0.500000 0.500000 1.000000 0.500000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 0.500000 0.500000 0.500000 1.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.500000 0.500000 0.500000 0.500000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 1.000000 0.500000 0.500000 0.500000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 0.500000 1.000000 0.500000 0.500000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 0.500000 0.500000 1.000000 0.500000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.500000 0.500000 0.500000 0.500000 1.000000 0.000000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.010000 0.000000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.010000 0.000000
   0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.010000
 ];

  R = Kll;
  W = inv(Kll);

  kxr20_18 = (g18r(1) - r(1)) / d_r_18r - (g20r(1) - r(1)) / d_r_20r
  kxr20_21 = (g21r(1) - r(1)) / d_r_21r - (g20r(1) - r(1)) / d_r_20r
  kxr20_25 = (g25r(1) - r(1)) / d_r_25r - (g20r(1) - r(1)) / d_r_20r
  kxr20_26 = (g26r(1) - r(1)) / d_r_26r - (g20r(1) - r(1)) / d_r_20r
  kxr20_29 = (g29r(1) - r(1)) / d_r_29r - (g20r(1) - r(1)) / d_r_20r

  kyr20_18 = (g18r(2) - r(2)) / d_r_18r - (g20r(2) - r(2)) / d_r_20r
  kyr20_21 = (g21r(2) - r(2)) / d_r_21r - (g20r(2) - r(2)) / d_r_20r
  kyr20_25 = (g25r(2) - r(2)) / d_r_25r - (g20r(2) - r(2)) / d_r_20r
  kyr20_26 = (g26r(2) - r(2)) / d_r_26r - (g20r(2) - r(2)) / d_r_20r
  kyr20_29 = (g29r(2) - r(2)) / d_r_29r - (g20r(2) - r(2)) / d_r_20r

  kzr20_18 = (g18r(3) - r(3)) / d_r_18r - (g20r(3) - r(3)) / d_r_20r
  kzr20_21 = (g21r(3) - r(3)) / d_r_21r - (g20r(3) - r(3)) / d_r_20r
  kzr20_25 = (g25r(3) - r(3)) / d_r_25r - (g20r(3) - r(3)) / d_r_20r
  kzr20_26 = (g26r(3) - r(3)) / d_r_26r - (g20r(3) - r(3)) / d_r_20r
  kzr20_29 = (g29r(3) - r(3)) / d_r_29r - (g20r(3) - r(3)) / d_r_20r

  % -0.3447 -0.7790 -0.0439 -1.0984 -0.1214 -0.3447 -0.7790 -0.0439 -1.0984 -0.1214 -0.3447 -0.7790 -0.0439 -1.0984 -0.1214 -0.3447 -0.7790 -0.0439 -1.0984 -0.1214
  % -0.6548 -0.6598 -0.4699 -0.3975  0.0326 -0.6548 -0.6598 -0.4699 -0.3975  0.0326 -0.6548 -0.6598 -0.4699 -0.3975  0.0326 -0.6548 -0.6598 -0.4699 -0.3975  0.0326
  %  0.9812  0.0203  0.8360 -0.1738 -0.1389  0.9812  0.0203  0.8360 -0.1738 -0.1389  0.9812  0.0203  0.8360 -0.1738 -0.1389  0.9812  0.0203  0.8360 -0.1738 -0.1389

  H = [
   kxr20_18 kxr20_21 kxr20_25 kxr20_26 kxr20_29 kxr20_18 kxr20_21 kxr20_25 kxr20_26 kxr20_29 kxr20_18 kxr20_21 kxr20_25 kxr20_26 kxr20_29 kxr20_18 kxr20_21 kxr20_25 kxr20_26 kxr20_29  1.0000  0.0000  0.0000
   kyr20_18 kyr20_21 kyr20_25 kyr20_26 kyr20_29 kyr20_18 kyr20_21 kyr20_25 kyr20_26 kyr20_29 kyr20_18 kyr20_21 kyr20_25 kyr20_26 kyr20_29 kyr20_18 kyr20_21 kyr20_25 kyr20_26 kyr20_29  0.0000  1.0000  0.0000
   kzr20_18 kzr20_21 kzr20_25 kzr20_26 kzr20_29 kzr20_18 kzr20_21 kzr20_25 kzr20_26 kzr20_29 kzr20_18 kzr20_21 kzr20_25 kzr20_26 kzr20_29 kzr20_18 kzr20_21 kzr20_25 kzr20_26 kzr20_29  0.0000  0.0000  1.0000
       -l1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
        l1      l1      l1      l1      l1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000     -l1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000     -l1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000     -l1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000     -l1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000  0.0000     -l2  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000  0.0000      l2      l2      l2      l2      l2  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000  0.0000  0.0000     -l2  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000     -l2  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000     -l2  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
    0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000     -l2  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
  ]

  P = 9.0*eye(15);
  
  K=P*H*inv(H'*P*H+R)
pause

sd_l1_G18_r01_r02 = r02G18e0001(1) - r01G18e0001(1);
sd_l1_G20_r01_r02 = r02G20e0001(1) - r01G20e0001(1);
sd_l1_G21_r01_r02 = r02G21e0001(1) - r01G21e0001(1);
sd_l1_G25_r01_r02 = r02G25e0001(1) - r01G25e0001(1);
sd_l1_G26_r01_r02 = r02G26e0001(1) - r01G26e0001(1);
sd_l1_G29_r01_r02 = r02G29e0001(1) - r01G29e0001(1);

sd_l2_G18_r01_r02 = r02G18e0001(2) - r01G18e0001(2);
sd_l2_G20_r01_r02 = r02G20e0001(2) - r01G20e0001(2);
sd_l2_G21_r01_r02 = r02G21e0001(2) - r01G21e0001(2);
sd_l2_G25_r01_r02 = r02G25e0001(2) - r01G25e0001(2);
sd_l2_G26_r01_r02 = r02G26e0001(2) - r01G26e0001(2);
sd_l2_G29_r01_r02 = r02G29e0001(2) - r01G29e0001(2);

sd_p1_G18_r01_r02 = r02G18e0001(3) - r01G18e0001(3);
sd_p1_G20_r01_r02 = r02G20e0001(3) - r01G20e0001(3);
sd_p1_G21_r01_r02 = r02G21e0001(3) - r01G21e0001(3);
sd_p1_G25_r01_r02 = r02G25e0001(3) - r01G25e0001(3);
sd_p1_G26_r01_r02 = r02G26e0001(3) - r01G26e0001(3);
sd_p1_G29_r01_r02 = r02G29e0001(3) - r01G29e0001(3);

sd_p2_G18_r01_r02 = r02G18e0001(4) - r01G18e0001(4);
sd_p2_G20_r01_r02 = r02G20e0001(4) - r01G20e0001(4);
sd_p2_G21_r01_r02 = r02G21e0001(4) - r01G21e0001(4);
sd_p2_G25_r01_r02 = r02G25e0001(4) - r01G25e0001(4);
sd_p2_G26_r01_r02 = r02G26e0001(4) - r01G26e0001(4);
sd_p2_G29_r01_r02 = r02G29e0001(4) - r01G29e0001(4);

dd_l1_G18_G20_r01_r02 = (sd_l1_G20_r01_r02 - sd_l1_G18_r01_r02)*l1;
dd_l1_G21_G20_r01_r02 = (sd_l1_G20_r01_r02 - sd_l1_G21_r01_r02)*l1;
dd_l1_G25_G20_r01_r02 = (sd_l1_G20_r01_r02 - sd_l1_G25_r01_r02)*l1;
dd_l1_G26_G20_r01_r02 = (sd_l1_G20_r01_r02 - sd_l1_G26_r01_r02)*l1;
dd_l1_G29_G20_r01_r02 = (sd_l1_G20_r01_r02 - sd_l1_G29_r01_r02)*l1;

dd_l2_G18_G20_r01_r02 = (sd_l2_G20_r01_r02 - sd_l2_G18_r01_r02)*l2;
dd_l2_G21_G20_r01_r02 = (sd_l2_G20_r01_r02 - sd_l2_G21_r01_r02)*l2;
dd_l2_G25_G20_r01_r02 = (sd_l2_G20_r01_r02 - sd_l2_G25_r01_r02)*l2;
dd_l2_G26_G20_r01_r02 = (sd_l2_G20_r01_r02 - sd_l2_G26_r01_r02)*l2;
dd_l2_G29_G20_r01_r02 = (sd_l2_G20_r01_r02 - sd_l2_G29_r01_r02)*l2;

dd_p1_G18_G20_r01_r02 = sd_p1_G20_r01_r02 - sd_p1_G18_r01_r02;
dd_p1_G21_G20_r01_r02 = sd_p1_G20_r01_r02 - sd_p1_G21_r01_r02;
dd_p1_G25_G20_r01_r02 = sd_p1_G20_r01_r02 - sd_p1_G25_r01_r02;
dd_p1_G26_G20_r01_r02 = sd_p1_G20_r01_r02 - sd_p1_G26_r01_r02;
dd_p1_G29_G20_r01_r02 = sd_p1_G20_r01_r02 - sd_p1_G29_r01_r02;

dd_p2_G18_G20_r01_r02 = sd_p2_G20_r01_r02 - sd_p2_G18_r01_r02;
dd_p2_G21_G20_r01_r02 = sd_p2_G20_r01_r02 - sd_p2_G21_r01_r02;
dd_p2_G25_G20_r01_r02 = sd_p2_G20_r01_r02 - sd_p2_G25_r01_r02;
dd_p2_G26_G20_r01_r02 = sd_p2_G20_r01_r02 - sd_p2_G26_r01_r02;
dd_p2_G29_G20_r01_r02 = sd_p2_G20_r01_r02 - sd_p2_G29_r01_r02;
  
%endif